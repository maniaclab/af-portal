{% extends "base.html" %}

{% block title %} Hardware {% endblock %}

{% block assets %}
<script src="https://unpkg.com/vue@3"></script>
{% endblock %}

{% block body %}
<section id="hardware">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a class="text-decoration-none" href="{{ url_for('home') }}">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Hardware</li>
            </ol>
        </nav>
        <div class="container col-sm-10">
            <h2>Interactive Nodes</h2>
            <table>
              <tr>
                <th>Access Protocol</th>
                <th>Number of Nodes</th>
                <th>Monitoring</th>
              </tr>
              <tr>
                <td>ssh</td>
                <td>2</td>
                <td>link to node monitoring</td>
              </tr>
              <tr>
                <td>Jupyter Notebook</td>
                <td>4</td>
                <td>link to notebook monitoring</td>
              </tr>
            </table>
            <h2>Batch Compute</h2>
            <table>
              <tr>
                <th>Queues</th>
                <th>Capacity(Number of Cores)</th>
                <th>Walltime Limit</th>
                <th>Notes</th>
              </tr>
              <tr>
                <td>long</td>
                <td>1520</td>
                <td>72 Hours</td>
                <td>The long queue jobs run on the hyperconvered nodes</td>
              </tr>
              <tr>
                <td>short</td>
                <td>1280</td>
                <td>4 Hours</td>
                <td>The short queue jobs can run on both the fast compute nodes and the hyperconvered nodes</td>
              </tr>
            </table>
            <h2>Storage Spaces</h2>
            <table>
              <tr>
                <th>Storage</th>
                <th>Type</th>
                <th>Capacity</th>
                <th>Default Quota</th>
                <th>Notes</th>
              </tr>
             <tr>
                <td>/data</td>
                <td>Ceph Filesystem</td>
                <td>1PB</td>
                <td>5TB</td>
                <td>Storage provided by the batch worker nodes. Two types of disks: spinning disks from hyperconvered nodes form the regular pool(in production), nvme disks from the fast compute nodes form the fast pool(to be configured)</td>
              </tr>
             <tr>
                <td>/home</td>
                <td>NFS filesystem</td>
                <td>33TB</td>
                <td>100GB</td>
                <td></td>
              </tr>
             <tr>
                <td>/scratch</td>
                <td>SSD Local Filesystem</td>
                <td>2TB on the hyperconvered nodes, 6TB on the fast compute nodes</td>
                <td>N/A</td>
                <td></td>
              </tr>
            </table>
            <br> 
            <hr>
            <h2>Hardware Specifications</h2>
            <table>
              <tr>
                <th>Node Type</th>
                <th>Number of Nodes</th>
                <th>Processor Per Node</th>
                <th>Cores Per Node</th>
                <th>Memory Per Node</th>
                <th>Storage Per Node</th>
              </tr>
              <tr>
                <td>Hyperconverged</td>
                <td>19</td>
                <td>Two AMD EPYC 7402 CPUs at 2.8 GHz</td>
                <td>48C/96T</td>
                <td>512 GB DDR4 SDRAM</td>
                <td>Two 960 GB SSD, four 2TB NVMe and twelve 16 TB spinning disks</td>
              </tr>
              <tr>
                <td>Fast Compute</td>
                <td>16</td>
                <td>Two Intel(R) Xeon(R) Gold 6348 CPU at 2.60 GHz</td>
                <td>56C/112T</td>
                <td>384 GB DDR4 SDRAM</td>
                <td>Ten 3.2 TB NVMe </td>
              </tr>
              <tr>
                <td>Interactive Nodes</td>
                <td>6</td>
                <td>Two AMD EPYC 7402 CPUs at 2.8 GHz</td>
                <td>48C/96T</td>
                <td>256 GB DDR4 SDRAM</td>
                <td>Two 960 GB SSD</td>
              </tr>
            </table>
            <table>
              <tr>
                <th>Node Type</th>
                <th>Number of Nodes</th>
                <th>Processor Per Node</th>
                <th>Cores Per Node</th>
                <th>Memory Per Node</th>
                <th>GPUs Per Node(Mem)</th>
                <th>Storage Per Node</th>
              </tr>
              <tr>
                <td>GPU A</td>
                <td>2</td>
                <td>Two AMD EPYC 7543 32-Core Processor</td>
                <td>64C/128T</td>
                <td>512 GB DDR4 SDRAM</td>
                <td>Four NVIDIA A100(40G) </td>
                <td>One 1.5TB NVMe</td>
              </tr>
              <tr>
                <td>GPU B</td>
                <td>1</td>
                <td>Two Intel(R) Xeon(R) Silver 4116 CPU @ 2.10GHz</td>
                <td>24C/48T</td>
                <td>96 GB DDR4 SDRAM</td>
                <td>Four Tesla V100(16G)</td>
                <td>Three 220GB SSD</td>
              </tr>
              <tr>
                <td>GPU C</td>
                <td>3</td>
                <td>Two Intel(R) Xeon(R) Gold 6146 CPU @ 3.20GHz</td>
                <td>24C/48T</td>
                <td>192 GB DDR4 SDRAM</td>
                <td>Eight NVIDIA GeForce RTX 2080 Ti(12G)</td>
                <td>Six 450GB SSD</td>
              </tr>
              <tr>
                <td>GPU D</td>
                <td>1</td>
                <td>Two Intel(R) Xeon(R) CPU E5-2687W v4 @ 3.00GHz</td>
                <td>24C</td>
                <td>128 GB DDR4 SDRAM</td>
                <td>Eight NVIDIA GeForce GTX 1080 Ti(12G)</td>
                <td>Six 450GB SSD</td>
              </tr>
            </table> 
            <br> 
            <h3>Network Switches</h3>
            <p>Two Juniper QFX5120 switches: 40 Gbps uplink, 48 10/25GbE SFP28 ports</p> 
        </div>
    </div>
    <div id="gpu-products" class="modal fade" role="dialog">
        <div class="modal-dialog" style="max-width: 600px">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">GPU Products</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div v-if="gpus" class="modal-body">
                    <p>Here is a table of our GPU products.</p>
                    <table class="table table-hover table-bordered nowrap w-100">
                        <thead>
                            <tr>
                                <th>GPU Product</th>
                                <th>Count</th>
                                <th>Avail.</th>
                                <th>Memory (MB)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="gpu in gpus">
                                <td>[[ gpu.product ]]</td>
                                <td>[[ gpu.count ]]</td>
                                <td>[[ gpu.available ]]</td>
                                <td>[[ gpu.memory ]]</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div v-else class="modal-body">
                    Loading...
                    <span class="spinner-border spinner-border-sm text-dark ms-2" role="status"></span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</section>
<script type="text/javascript">
$(document).ready(function() {
    const { createApp } = Vue

    createApp({
        delimiters: ["[[", "]]"],
        data() {
            return {
                gpus: null
            }
        },
        async mounted() {
            const response = await fetch("{{ url_for('get_gpus') }}");
            const json = await response.json()
            this.gpus = json.gpus
        }
    }).mount("#hardware");
});    
</script>
{% endblock %}
